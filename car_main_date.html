<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        .service-detail {
            float: left;
            background-color: #edebeb;
            width: 250px;
            padding: 6px;
            height: 295px;
            margin: 6px;
        }

        .circle {
            display: flex;
            width: 30px;
            height: 30px;
            background: rgb(195, 240, 195);
            border-radius: 50%;
            justify-content: center;
            align-items: center;
        }

        .circle_information {
            background: rgb(250, 250, 8);
        }

        .circle_warning {
            background: rgb(143, 27, 27);
        }
    </style>
</head>

<body>
    <div id="dv-services">
        <div class="service-detail">
            <h2>Óleo motor + filtro</h2>
            <strong>Change info</strong>
            <p>Months: 12 Km: 10</p>
            <strong>Change info</strong>
            <p>lastDate, lastKm</p>
        </div>
    </div>

    <script>
        //Automobile
        //Maintenance
        class Service {
            constructor(service) {
                this.service = service;
            }

            getValidateDate(compareDate) {
                if (this.service.months > 0 && this.service.lastDate) {
                    const validateDate = new Date(this.service.lastDate);
                    validateDate.setMonth(validateDate.getMonth() + this.service.months);

                    return validateDate;
                }

                return null;
            }

            getValidateKm(compareKm) {
                if (this.service.km > 0 && this.service.lastKm > 0) {
                    return this.service.lastKm + (this.service.km * 1000);
                }

                return 0;
            }
        }

        function frmDate(inDate, strLocation) {
            return inDate.toLocaleDateString(strLocation);
        }

        function frmKm(inKm, strLocation) {
            return inKm.toLocaleString(strLocation);
        }

        function dateToState(currentDate, endDate) {
            if (endDate) {
                const intermedDate = new Date(endDate);
                intermedDate.setMonth(intermedDate.getMonth() - 2);

                if (currentDate >= endDate) {
                    return 3;
                } else if (intermedDate >= endDate) {
                    return 2;
                } else {
                    return 1;
                }
            }

            return 0;
        }

        function kmToState(currentKm, endKm) {
            if (endKm > 0) {
                const intermedKm = endKm - 500;
                if (currentKm >= endKm) {
                    return 3;
                } else if (intermedKm >= endKm) {
                    return 2;
                } else {
                    return 1;
                }
            }

            return 0;
        }

        function serviceToHTML(services, currentKm, currentDate) {
            let content = "";

            services.forEach(s => {
                const endKm = s.getValidateKm(currentKm);
                const endDate = s.getValidateDate(currentDate);
                
                const kmState = kmToState(currentKm, endKm);
                const dateState = dateToState(currentDate, endDate);
                const state = Math.max(kmState, dateState);

                let stateClass = "circle";
                if (state == 3) {
                    stateClass += " circle_warning";
                } else if (state == 2) {
                    stateClass += " circle_information";
                }

                content += `<div class="service-detail"><div class="${stateClass}"></div><h2>${s.service.name}</h2>`;
                content += `<strong>Change info</strong><p>Months: ${s.service.months} Km: ${frmKm(s.service.km * 1000, "pt-BR")}</p>`;
                content += `<p><strong>Next Change info</strong></p>`;

                //content += `<span class="cls-urgente">!!!</span>`;
                if (endDate) {
                    content += `<span><strong>Date to next change</strong> ${frmDate(endDate, "pt-BR")}</span></br>`;
                }

                if (endKm > 0) {
                    content += `<span><strong>Km to next change</strong> ${frmKm(endKm, "pt-BR")}</span></br>`;
                }

                content += `</div>`;
            });

            return content;
        }

        const services = [];
        //services.push({name: "", months: 0, km: 0, lastDate: new Date(), lastKm: 0 });
        services.push(new Service({ name: "Óleo motor + filtro", months: 12, km: 10, lastDate: new Date("2024/11/01"), lastKm: 92000 }));
        services.push(new Service({ name: "Correia dentada", months: 0, km: 260, lastDate: null, lastKm: 0 }));
        services.push(new Service({ name: "Filtro de ar", months: 0, km: 40, lastDate: new Date("2024/11/01"), lastKm: 69629 }));
        services.push(new Service({ name: "Velas", months: 0, km: 40, lastDate: new Date("2020/07/01"), lastKm: 70600 }));
        services.push(new Service({ name: "Filtro Combustível", months: 24, km: 20, lastDate: new Date("2024/11/01"), lastKm: 69629 }));
        services.push(new Service({ name: "Liq. arrefecimento (substituição)", months: 72, km: 160, lastDate: new Date("2018/04/01"), lastKm: 0 }));
        services.push(new Service({ name: "Tampa reservatório expansão", months: 36, km: 0, lastDate: new Date("2018/04/01"), lastKm: 0 }));
        services.push(new Service({ name: "Verificar transmissão", months: 6, km: 0, lastDate: new Date("2018/04/01"), lastKm: 0 }));
        services.push(new Service({ name: "Fluído embreagem", months: 12, km: 10, lastDate: new Date("2020/07/01"), lastKm: 69629 }));
        services.push(new Service({ name: "Fluído transmissão manual", months: 0, km: 260, lastDate: new Date("2018/04/01"), lastKm: 0 }));
        services.push(new Service({ name: "Suspensão verificar", months: 24, km: 20, lastDate: new Date("2020/07/01"), lastKm: 69629 }));
        services.push(new Service({ name: "Amortecedores dianteiros", months: 36, km: 30, lastDate: new Date("2018/04/01"), lastKm: 0 }));
        services.push(new Service({ name: "Amortecedores traseiros", months: 36, km: 30, lastDate: new Date("2023/02/01"), lastKm: 86767 }));
        services.push(new Service({ name: "Fluido do freio substituir", months: 24, km: 0, lastDate: new Date("2023/09/01"), lastKm: 0 }));
        services.push(new Service({ name: "Fluido do freio verificar tubulações e mangueiras flexíveis", months: 36, km: 30, lastDate: new Date("2020/07/01"), lastKm: 69629 }));
        services.push(new Service({ name: "Pneus Dianteiros", months: 36, km: 30, lastDate: new Date("2023/10/01"), lastKm: 59000 }));
        services.push(new Service({ name: "Pneus Traseiros", months: 36, km: 30, lastDate: new Date("2018/04/01"), lastKm: 45000 }));
        services.push(new Service({ name: "Pastilhas e discos de freio", months: 36, km: 30, lastDate: new Date("2019/04/01"), lastKm: 59000 }));
        services.push(new Service({ name: "Sistema de refrigeração", months: 36, km: 30, lastDate: new Date("2018/04/01"), lastKm: 0 }));
        services.push(new Service({ name: "Higienização ar condicionado", months: 6, km: 0, lastDate: new Date("2024/11/01"), lastKm: 0 }));
        services.push(new Service({ name: "Bateria", months: 48, km: 0, lastDate: null, lastKm: 0 }));

        const carKm = 87000;
        const dt = new Date();
        document.querySelector('#dv-services').innerHTML = serviceToHTML(services, carKm, dt);
    </script>
</body>

</html>